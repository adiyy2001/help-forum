"use strict";var express=require("express"),router=new express.Router,User=require("../models/user"),bcrypt=require("bcryptjs");router.get("/users/register",function(e,r){r.render("register")}),router.post("/users/register",function(e,s){var n=e.body.name,t=e.body.surname,i=e.body.nick,a=e.body.email,c=e.body.voivodeship,y=e.body.city,d=e.body.password,u=e.body.password2;e.checkBody("name","Imie jest wymagane").notEmpty(),e.checkBody("nick","Nick jest wymagane").notEmpty(),e.checkBody("email","Email jest wymagany").notEmpty(),e.checkBody("email","Email jest niepoprawny").isEmail(),e.checkBody("nick","Nick jest wymagany").notEmpty(),e.checkBody("password","Hasło jest wymagany").notEmpty(),e.checkBody("password2","hasła nie są równe").equals(d),e.getValidationResult().then(function(e){if(e.isEmpty()){var o=new User({name:n,surname:t,nick:i,email:a,password:d,password2:u,voivodeship:c,city:y});bcrypt.genSalt(10,function(e,r){bcrypt.hash(o.password,r,function(e,r){e&&console.log(e),o.password=r,o.save(function(e){e?console.log(e):s.redirect("/users/login")})})})}else{var r=e.array().map(function(e){return e.msg});console.log("There are following validation errors: "+r.join("&&")),s.render("register",{errors:r})}})}),router.get("/users/login",function(e,r){r.render("login")}),module.exports=router;